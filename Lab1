/* 
 * File:   newmain.c
 * Author: Microex
 *
 * Created on 12 September, 2014, 2:46 PM
 * Updated on 17 September, 2014, 17:30 PM
 */

#define Light_thres 700
//#include <xc.h>                                    //PIC hardware mapping
#include <pic16f688.h>

//config bits that are part-specific for the PIC16F1829
#pragma config /*FOSC=INTOSC,*/ WDTE=OFF, MCLRE=OFF

/*
 * 
 */

void delay(unsigned dly)
{
 unsigned int temp;
 for(;dly>0;dly--)
 for(temp=1000;temp>0;temp--);
}

int Readadc(void)
{
    int adcval = 0;
    ADCON0bits.GO_DONE =  1;   //Start conversion
    while(ADCON0bits.GO_DONE == 1);
    adcval = ((ADRESH << 8) | ADRESL) ;
    return adcval;
}
void main(void)
{
 unsigned int adc_read = 0;

 OSCCON = 0b01110001;  //8MHZ clock using internal oscillator
 TRISC = 0b00001000; // PORTC RC3 set as

 ANSEL = 0b10000000; //set pin RA2 as analog
 ADCON1 = 0b0101000;  //clock conversion FOSC/16
 ADCON0 = 0b10011101; // ADC enable / Right justified / AD7 channel
 PORTCbits.RC2 = 1;
 while(1)
 {
  delay(10);
  adc_read = Readadc();    //read ldr value
  if(adc_read < Light_thres)
     PORTCbits.RC2 = 1; //RC2 is high level  //LED OFF
  else
     PORTCbits.RC2 = 0; //RC2 is low level  //LED ON
 
  /*
  PORTCbits.RC2 = 1; //RC0 is high level
  delay(10);
  PORTCbits.RC2 = 0; //RC0 is low level
  delay(10);
   */
 }

}
