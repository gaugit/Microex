/* 
 * File:   newmain.c
 * Author: Microex
 *
 * Created on 12 September, 2014, 2:46 PM
 */

#define Light_thres 300
//#include <xc.h>                                    //PIC hardware mapping
#include <pic16f688.h>
//#define _XTAL_FREQ 500000                           //Used by the XC8 delay_ms(x) macro

//config bits that are part-specific for the PIC16F1829
#pragma config /*FOSC=INTOSC,*/ WDTE=OFF, MCLRE=OFF
//#pragma config WRT=OFF, PLLEN=OFF, STVREN=OFF, LVP=OFF

/*
 * 
 */

void delay(unsigned dly)
{
 unsigned int temp;
 for(;dly>0;dly--)
 for(temp=1000;temp>0;temp--);
}

int Readadc(void)
{
    int adcval = 0;
    ADCON0bits.GO_DONE =  1;   //Start conversion
    while(ADCON0bits.GO_DONE == 1);
    adcval = ((ADRESH << 8) | ADRESL) ;
    return adcval;
}

void main(void)
{
 int adc_read = 0;
 TRISA = 0b00000100; // PORTA PIN2 set as input
 TRISC = 0b00000000; // PORTC All Outputs

 ANSEL = 0b00000100; //set pin RA2 as analog
 ADCON1 = 0b0101000;  //clock conversion FOSC/16
 ADCON0 = 0b00001001; // ADC enable

 while(1)
 {

  adc_read = Readadc();    //read ldr value
  if(adc_read > Light_thres)
     PORTCbits.RC0 = 1; //RC0 is high level
  else
      PORTCbits.RC0 = 0; //RC0 is low level
      
      
  /*
  PORTCbits.RC0 = 1; //RC0 is high level
  delay(1);
  PORTCbits.RC0 = 0; //RC0 is low level
  delay(1);
  */
 }

}
